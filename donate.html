<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ”¯æŒ OSæ˜Ÿç«çš„æ•¸ä½å‰µä½œ</title>
  <script src="config.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    body{
      font-family:"DFKai-SB","Noto Sans TC",sans-serif;
      background:#fafafa;text-align:center;color:#333;padding:2rem;
    }
    header img{
      width:100px;height:100px;border-radius:20%;
      box-shadow:0 3px 8px rgba(0,0,0,.2);
    }
    h1{color:#e91e63;margin-top:1rem;}
    #rate{margin:1rem 0;color:#555;}
    #donate-input{
      display:flex;justify-content:center;align-items:center;
      gap:8px;margin:1rem auto;
    }
    #donate-input input{
      width:100px;text-align:right;padding:6px;
      border:1px solid #ccc;border-radius:6px;font-size:1rem;
    }
    #qrcode{margin:2rem auto;width:180px;height:180px;}
    #wallet{
      font-size:.95rem;word-break:break-all;margin:1rem auto;
      max-width:320px;background:#fff;padding:.6rem;
      border-radius:8px;border:1px solid #ccc;
    }
    button{
      background:linear-gradient(90deg,#ff758c,#ff7eb3);
      color:white;border:none;border-radius:8px;
      padding:.8rem 1.5rem;margin-top:1rem;
      cursor:pointer;font-weight:bold;font-size:1rem;
      transition:transform .2s;
    }
    button:hover{transform:scale(1.05);}
    footer{margin-top:3rem;color:#777;font-size:.9rem;}
  </style>
</head>
<body>
<header>
  <img src="icons/icon-192.png" alt="OSæ˜Ÿç« Logo">
  <h1>ğŸ’– æ”¯æŒ OSæ˜Ÿç«çš„æ•¸ä½å‰µä½œ</h1>
  <div id="rate">è¼‰å…¥å³æ™‚åŒ¯ç‡ä¸­...</div>
</header>

<main>
  <div id="donate-input">
    <label for="dot">è¼¸å…¥é‡‘é¡ï¼š</label>
    <input id="dot" type="number" min="0" step="0.01" placeholder="1.0">
    <span>DOT â‰ˆ</span><span id="twd">-- å…ƒ</span>
  </div>

  <div id="qrcode"></div>
  <div id="wallet"></div>
  <button onclick="copyAddr()">ğŸ“‹ è¤‡è£½åœ°å€</button><br>
  <button onclick="location.href='index.html'">è¿”å›ä¸»é </button>
</main>

<footer>
  <p>æ„Ÿè¬æ‚¨çš„æ”¯æŒ â€” æ¯ä¸€ä»½è´ŠåŠ©éƒ½æ˜¯ OSæ˜Ÿç« å»¶çºŒå‰µæ„çš„ç‡ƒæ–™ âœ¨</p>
</footer>

<script>
  const cfg = window.GENEALOGY_CONFIG;
  const addr = cfg.donate.dotAddress;
  let rate = 0;

  document.getElementById('wallet').textContent = addr;

  new QRCode(document.getElementById('qrcode'), {
    text: addr,
    width: 180,
    height: 180
  });

  function copyAddr(){
    navigator.clipboard.writeText(addr).then(
      ()=>alert("âœ… å·²è¤‡è£½åœ°å€ï¼Œå¯å‰å¾€æ‚¨çš„éŒ¢åŒ…é€²è¡Œè½‰å¸³")
    );
  }

  async function getRate(){
    try{
      const r = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=polkadot&vs_currencies=twd");
      const d = await r.json();
      rate = d.polkadot.twd;
      document.getElementById('rate').innerHTML =
        `ğŸ’° 1 DOT â‰ˆ <b>${rate.toLocaleString()}</b> æ–°å°å¹£`;
    }catch(e){
      document.getElementById('rate').textContent =
        "âš ï¸ ç„¡æ³•å–å¾—å³æ™‚åŒ¯ç‡ï¼Œè«‹ç¨å¾Œå†è©¦";
    }
  }
  getRate();

  document.getElementById('dot').addEventListener('input', e=>{
    const v = parseFloat(e.target.value)||0;
    if(rate>0){
      const twd = v*rate;
      document.getElementById('twd').textContent =
        `${twd.toLocaleString(undefined,{maximumFractionDigits:2})} å…ƒ`;
    }else{
      document.getElementById('twd').textContent="-- å…ƒ";
    }
  });
</script>
</body>
</html>
